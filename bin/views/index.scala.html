@(events: List[pojo.Event]) @main("Memebrancer 1.1") {

<script>

var selectedEvent;

$(document).ready(function() {

    $('#calendar').fullCalendar({
      header: {
        left: 'prev,next today',
        center: 'title',
        right: 'month,listMonth'
      },
      navLinks: true,
      editable: true,
      eventDrop: function(event, delta, revertFunc) {

    	//ajax call    	
    	var calDate = new Date(event.start);
		calDate.setFullYear(event.className[0]);
		
		var dateStr = event.title.split(' ')[1] + pad(calDate.getMonth()+1,2) + pad(calDate.getDate(),2)
    	var saveStr = dateStr+";"+event.className[0].split(';')[1]+";"+event.title.split(':')[0];

		/*$.ajax({
	 	           url:'/update',
	 	           method: 'GET',
	 	           data: { event: event.id+";"+saveStr},
	 	           success:function(data){
	 	        	   console.log('response: '+data);
	 	        	   return false;
	 	           }
	 	  });*/
    	   

    	  },
      dayClick: function(date, jsEvent, view) {

			//reset form
			selectedEvent=null;
			document.getElementById("eventForm").reset();
			
			//set values we know
			$('#eventId').val(-1);
			var d = new Date(date);
			$('#eventDate').val(d.toLocaleDateString("de-CH")); 
			$('#eventType').val(1);

    	  },
      eventClick: function(calEvent, jsEvent, view) {

			//populate form
			selectedEvent=calEvent;
			
			$.ajax({
		 	    url:'/getEventById',
		 	    method: 'GET',
		 	    data: { eventId: calEvent.id},
		 	    success:function(data){
					$('#eventId').val(data.lineNr);
		 	        $('#eventName').val(data.name);
					var d = new Date(data.date);
					$('#eventDate').val(d.toLocaleDateString("de-CH")); 
					$('#eventType').val(data.type);
		 	        return false;
		 	        }
		 	});

  	  },
      events: [
       
        @for(event <- events) {
			  {
				    id: @event.getLineNr(),
					title: '@event.getDisplayName()',
					allDay: true,
					className: '@event.toGuiDate()' ,
					start: new Date((new Date()).getFullYear(), @event.getMonth(), @event.getDay()),
					@if(event.getType==0){ color: 'black' }
				},
		}
      ]
    });
  });
  
$('#calendar').fullCalendar({
	  
	});
	
function pad(num, size) {
    var s = num+"";
    while (s.length < size) s = "0" + s;
    return s;
}

function saveEvent() {
    console.log('saving...');
	var eventId = $('#eventId').val();
	var eventName = $('#eventName').val();
	var eventType = $('#eventType').val();
	var eventDate = $('#eventDate').val();
	var eventDateAsDate = new Date(eventDate.split('.')[2],eventDate.split('.')[1]-1,eventDate.split('.')[0])
	var diff = new Date().getFullYear() - eventDateAsDate.getFullYear();
	var eventTitle = eventName+": "+eventDateAsDate.getFullYear() + " ("+diff+")";
	eventDateAsDate.setFullYear(new Date().getFullYear());
	
	if(eventId<0){ //insert
		var eventObject={id:-1, title: eventTitle, start: eventDateAsDate, allDay: true};
		if(eventType=="0"){
			eventObject.color='black';
		}

		//ajax call
		$.ajax({
		 	url:'/create',
		 	method: 'GET',
		 	data: { event: "-1;"+eventDate+";"+eventType+";"+eventName},
					success:function(data){
		 	        }
		 	});
		
		console.log(eventObject);
		$('#calendar').fullCalendar('renderEvent', eventObject, true);

	}else{
		console.log(selectedEvent);
		selectedEvent.title=eventTitle;
		$('#calendar').fullCalendar('updateEvent', selectedEvent);

		//ajax call
		$.ajax({
			url:'/update',
			method: 'GET',
			data: { event: eventId+";"+eventDate+";"+eventType+";"+eventName},
			success:function(data){
				console.log('response: '+data);
				return false;
			 }
		});
	}
}

function deleteEvent(){

   var eventId = $('#eventId').val();

   $('#calendar').fullCalendar('removeEvents', eventId);

	//delete
	$.ajax({
		url:'/delete',
		method: 'GET',
		data: { eventId: eventId},
		success:function(data){
		 	console.log('response: '+data);
		 	return false;
		}
	});
				   
	document.getElementById("eventForm").reset();
}

</script>
<style>
body {
	margin: 20px 10px;
	padding: 0;
	font-family: "Lucida Grande", Helvetica, Arial, Verdana, sans-serif;
	font-size: 14px;
}

#calendar {
	max-width: 900px;
	margin: 0 auto;
}
</style>


<div style="text-align: center;">  
<form id="eventForm">

<input type="hidden" id="eventId" />

<label>Event Date:</label>
<input type="text" size=10 id="eventDate" placeholder="Date"/>
<label>Name:</label>
<input type="text" id="eventName" placeholder="Name"/>
<label>Type:</label>
<input type="text" id="eventType" placeholder="Type"/>
</form>
<br>
<input type="button" id="saveEvent" onclick="saveEvent()" value="Save"/>
<input type="button" id="deleteEvent" onclick="deleteEvent()" value="Delete"/>
</div>

<br>

<div id='calendar'></div>


}
